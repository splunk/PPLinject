#pragma once

#include "ntdll.h"

#include <Windows.h>
#include <strsafe.h>
#include <Lmcons.h>
#include <tlhelp32.h>
#include <shlwapi.h>
#include <aclapi.h>
#include <shellapi.h>
#include <DbgHelp.h>
#include <comdef.h>
#include <versionhelpers.h>

#pragma comment(lib, "Shlwapi.lib")
#pragma comment(lib, "Advapi32.lib")
#pragma comment(lib, "Shell32.lib")
#pragma comment(lib, "Dbghelp.lib")

extern HMODULE g_hInstance;
extern HANDLE g_hConsoleOutput;
extern DWORD g_dwProcessId;
extern LPWSTR g_pwszDllPath;
extern LPWSTR g_pwszGuid;
extern BOOL g_bVerbose;
extern BOOL g_bDebug;

void DoStuff();
void LogToConsole(LPCWSTR pwszFormat, ...);
void LogLastError(LPCWSTR pwszFunctionName);
BOOL GetCurrentDllFileName(LPWSTR* ppwszDllName);
BOOL DeleteKnownDllEntry(LPCWSTR pwszDllName);
BOOL ParseCommandLine();
BOOL InjectDll(DWORD dwProcessId, LPWSTR pwszDumpFilePath);

const int ProcessMitigationPolicy = 52;

struct PROCESS_MITIGATION
{
	PROCESS_MITIGATION_POLICY Policy;
	DWORD Flags;
};

typedef HMODULE (*LoadLibraryPtr)(LPCSTR);

typedef struct _LoadLibraryThread
{
	LoadLibraryPtr LoadLibraryW;
	FARPROC GetLastError;
	PCHAR DllPath;
} LoadLibraryThread;
